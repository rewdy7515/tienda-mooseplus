-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.banners (
  id_banner bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  imagen text NOT NULL,
  redireccion text,
  oculto boolean,
  posicion smallint,
  imagen_movil text,
  titulo text,
  CONSTRAINT banners_pkey PRIMARY KEY (id_banner)
);
CREATE TABLE public.carrito_items (
  id_item bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_carrito bigint,
  cantidad smallint NOT NULL,
  id_precio bigint,
  meses smallint NOT NULL,
  id_cuenta bigint,
  id_perfil bigint,
  renovacion boolean,
  id_venta bigint,
  CONSTRAINT carrito_items_pkey PRIMARY KEY (id_item),
  CONSTRAINT carrito_items_id_carrito_fkey FOREIGN KEY (id_carrito) REFERENCES public.carritos(id_carrito),
  CONSTRAINT carrito_items_id_precio_fkey FOREIGN KEY (id_precio) REFERENCES public.precios(id_precio),
  CONSTRAINT carrito_items_id_cuenta_fkey FOREIGN KEY (id_cuenta) REFERENCES public.cuentas(id_cuenta),
  CONSTRAINT carrito_items_id_perfil_fkey FOREIGN KEY (id_perfil) REFERENCES public.perfiles(id_perfil),
  CONSTRAINT carrito_items_id_venta_fkey FOREIGN KEY (id_venta) REFERENCES public.ventas(id_venta)
);
CREATE TABLE public.carritos (
  id_carrito bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  fecha_creacion date DEFAULT now(),
  id_usuario bigint,
  monto_usd double precision,
  monto_bs double precision,
  hora time without time zone,
  fecha date,
  tasa_bs double precision,
  descuento double precision,
  monto_final double precision,
  usa_saldo boolean,
  hora_creacion time without time zone,
  CONSTRAINT carritos_pkey PRIMARY KEY (id_carrito),
  CONSTRAINT carritos_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.categorias (
  id_categoria smallint GENERATED ALWAYS AS IDENTITY NOT NULL,
  nombre text NOT NULL,
  CONSTRAINT categorias_pkey PRIMARY KEY (id_categoria)
);
CREATE TABLE public.cuentas (
  id_cuenta bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  correo text,
  clave text,
  fecha_corte date,
  fecha_pagada date,
  inactiva boolean,
  ocupado boolean,
  id_plataforma bigint,
  id_proveedor bigint,
  region text,
  correo_codigo text,
  clave_codigo text,
  link_codigo text,
  pin_codigo text,
  instaddr boolean,
  venta_perfil boolean,
  venta_miembro boolean,
  id_cuenta_madre bigint,
  direccion text,
  dominio_de bigint,
  venta_dominio boolean,
  cuenta_madre boolean,
  pin integer,
  CONSTRAINT cuentas_pkey PRIMARY KEY (id_cuenta),
  CONSTRAINT cuentas_id_plataforma_fkey FOREIGN KEY (id_plataforma) REFERENCES public.plataformas(id_plataforma),
  CONSTRAINT cuentas_id_proveedor_fkey FOREIGN KEY (id_proveedor) REFERENCES public.proveedores(id_proveedor),
  CONSTRAINT cuentas_dominio_de_fkey FOREIGN KEY (dominio_de) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT cuentas_id_cuenta_madre_fkey FOREIGN KEY (id_cuenta_madre) REFERENCES public.cuentas(id_cuenta)
);
CREATE TABLE public.descuentos (
  id_descuento bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  meses smallint NOT NULL,
  descuento_1 real,
  descuento_2 real,
  descuento_3 real,
  descuento_4 real,
  CONSTRAINT descuentos_pkey PRIMARY KEY (id_descuento)
);
CREATE TABLE public.eventos_notificacion_nuevo_servicio (
  id_evento bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_venta bigint NOT NULL,
  id_usuario bigint NOT NULL,
  id_cuenta bigint,
  id_plataforma bigint,
  plataforma text,
  correo_cuenta text,
  perfil text,
  fecha_corte date,
  procesado boolean NOT NULL DEFAULT false,
  procesado_en timestamp with time zone,
  ultimo_error text,
  creado_en timestamp with time zone NOT NULL DEFAULT now(),
  actualizado_en timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT eventos_notificacion_nuevo_servicio_pkey PRIMARY KEY (id_evento)
);
CREATE TABLE public.historial_reemplazos (
  id_reemplazo bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  tipo_item timestamp with time zone NOT NULL DEFAULT now(),
  id_item bigint,
  id_usuario bigint,
  correo_anterior text,
  perfil_anterior text,
  correo_nuevo text,
  perfil_nuevo text,
  motivo text,
  fecha date DEFAULT now(),
  CONSTRAINT historial_reemplazos_pkey PRIMARY KEY (id_reemplazo),
  CONSTRAINT historial_reemplazos_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.historial_ventas (
  id_historial_ventas bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_usuario_cliente bigint,
  id_proveedor bigint,
  monto real NOT NULL,
  fecha_pago date,
  venta_cliente boolean,
  renovacion boolean,
  id_venta bigint,
  id_plataforma bigint,
  id_cuenta bigint,
  registrado_por bigint,
  id_metodo_de_pago bigint,
  referencia text,
  comprobante text,
  hora_pago time without time zone,
  id_orden bigint,
  CONSTRAINT historial_ventas_pkey PRIMARY KEY (id_historial_ventas),
  CONSTRAINT historial_ventas_id_plataforma_fkey FOREIGN KEY (id_plataforma) REFERENCES public.plataformas(id_plataforma),
  CONSTRAINT historial_ventas_registrado_por_fkey FOREIGN KEY (registrado_por) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT historial_ventas_id_usuario_cliente_fkey FOREIGN KEY (id_usuario_cliente) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT historial_ventas_id_metodo_de_pago_fkey FOREIGN KEY (id_metodo_de_pago) REFERENCES public.metodos_de_pago(id_metodo_de_pago),
  CONSTRAINT historial_ventas_id_orden_fkey FOREIGN KEY (id_orden) REFERENCES public.ordenes(id_orden),
  CONSTRAINT historial_ventas_id_proveedor_fkey FOREIGN KEY (id_proveedor) REFERENCES public.proveedores(id_proveedor)
);
CREATE TABLE public.metodos_de_pago (
  id_metodo_de_pago bigint NOT NULL,
  nombre text,
  correo text,
  id text,
  cedula text,
  telefono text,
  hay_comision boolean,
  imagen text,
  color_fondo text,
  verificacion_automatica boolean,
  CONSTRAINT metodos_de_pago_pkey PRIMARY KEY (id_metodo_de_pago)
);
CREATE TABLE public.metricas_clientes_activos_mes (
  periodo_mes date NOT NULL,
  id_usuario bigint NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT metricas_clientes_activos_mes_pkey PRIMARY KEY (periodo_mes, id_usuario),
  CONSTRAINT metricas_clientes_activos_mes_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.metricas_mensuales (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  clientes_activos smallint NOT NULL,
  ventas_activas smallint,
  clientes_nuevos smallint,
  periodo_mes date,
  ventas_unicas integer,
  clientes_abandonaron integer,
  clientes_registrados_web integer,
  clientes_nuevos_web smallint,
  CONSTRAINT metricas_mensuales_pkey PRIMARY KEY (id)
);
CREATE TABLE public.notificacion_plantilla (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  titulo text NOT NULL,
  mensaje text,
  CONSTRAINT notificacion_plantilla_pkey PRIMARY KEY (id)
);
CREATE TABLE public.notificaciones (
  id_notificacion bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  titulo text NOT NULL,
  mensaje text,
  fecha date,
  leido boolean,
  id_usuario bigint,
  id_cuenta bigint,
  id_orden bigint,
  CONSTRAINT notificaciones_pkey PRIMARY KEY (id_notificacion),
  CONSTRAINT notificaciones_id_orden_fkey FOREIGN KEY (id_orden) REFERENCES public.ordenes(id_orden),
  CONSTRAINT notificaciones_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.ordenes (
  id_orden bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_usuario bigint,
  fecha date DEFAULT now(),
  total real,
  estado text,
  id_metodo_de_pago bigint,
  id_carrito bigint,
  comprobante text,
  referencia text,
  tasa_bs double precision,
  num_telefono text,
  monto_bs double precision,
  hora_orden time without time zone,
  en_espera boolean,
  pago_verificado boolean,
  monto_completo boolean,
  orden_cancelada boolean,
  id_admin bigint,
  recargar_saldo boolean,
  hora_confirmacion time without time zone,
  checkout_finalizado boolean,
  marcado_pago boolean,
  CONSTRAINT ordenes_pkey PRIMARY KEY (id_orden),
  CONSTRAINT ordenes_id_metodo_de_pago_fkey FOREIGN KEY (id_metodo_de_pago) REFERENCES public.metodos_de_pago(id_metodo_de_pago),
  CONSTRAINT ordenes_id_carrito_fkey FOREIGN KEY (id_carrito) REFERENCES public.carritos(id_carrito),
  CONSTRAINT ordenes_id_admin_fkey FOREIGN KEY (id_admin) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT ordenes_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.pagina (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  logo text,
  preview text,
  icono_pestana text,
  CONSTRAINT pagina_pkey PRIMARY KEY (id)
);
CREATE TABLE public.pagomoviles (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  titulo text NOT NULL,
  texto text,
  fecha text,
  dispositivo text,
  app text,
  hash text,
  referencia bigint,
  fecha_pago time without time zone,
  monto_bs double precision,
  num_telefono text,
  saldo_acreditado_a bigint,
  saldo_acreditado boolean,
  hora_recibido time without time zone,
  CONSTRAINT pagomoviles_pkey PRIMARY KEY (id),
  CONSTRAINT pagomoviles_saldo_acreditado_a_fkey FOREIGN KEY (saldo_acreditado_a) REFERENCES public.usuarios(id_usuario)
);
CREATE TABLE public.perfiles (
  id_perfil bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  pin integer,
  id_cuenta bigint,
  ocupado boolean,
  n_perfil smallint,
  perfil_hogar boolean,
  correo text,
  id_cuenta_miembro bigint,
  CONSTRAINT perfiles_pkey PRIMARY KEY (id_perfil),
  CONSTRAINT perfiles_id_cuenta_fkey FOREIGN KEY (id_cuenta) REFERENCES public.cuentas(id_cuenta)
);
CREATE TABLE public.plataformas (
  id_plataforma bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  nombre character varying NOT NULL,
  usa_pines boolean NOT NULL,
  entrega_inmediata boolean NOT NULL,
  num_max_dispositivos smallint,
  miembros boolean,
  imagen text,
  id_categoria bigint,
  por_pantalla boolean,
  por_acceso boolean,
  tarjeta_de_regalo boolean,
  max_dig_pin smallint,
  descuento_meses boolean,
  cuenta_madre boolean,
  corte_por_clave boolean,
  corte_de_usuario boolean,
  correo_cliente boolean,
  clave_cliente boolean,
  no_disponible boolean,
  mas_perfiles boolean,
  color_1 text,
  color_2 text,
  corte_directo boolean,
  max_miembros smallint,
  mostrar_stock boolean,
  color_3 text,
  banner text,
  link_pagina text,
  posicion smallint,
  id_descuento_mes bigint,
  id_descuento_cantidad bigint,
  aplica_descuento_mes_detal boolean NOT NULL DEFAULT true,
  aplica_descuento_mes_mayor boolean NOT NULL DEFAULT true,
  aplica_descuento_cantidad_detal boolean NOT NULL DEFAULT true,
  aplica_descuento_cantidad_mayor boolean NOT NULL DEFAULT true,
  CONSTRAINT plataformas_pkey PRIMARY KEY (id_plataforma),
  CONSTRAINT plataformas_id_categoria_fkey FOREIGN KEY (id_categoria) REFERENCES public.categorias(id_categoria),
  CONSTRAINT plataformas_id_descuento_mes_fkey FOREIGN KEY (id_descuento_mes) REFERENCES public.descuentos(id_descuento),
  CONSTRAINT plataformas_id_descuento_cantidad_fkey FOREIGN KEY (id_descuento_cantidad) REFERENCES public.descuentos(id_descuento)
);
CREATE TABLE public.precios (
  id_precio bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  cantidad smallint,
  plan character varying,
  valor_tarjeta_de_regalo character varying,
  region character varying,
  precio_usd_detal real,
  precio_usd_mayor real,
  duracion smallint,
  id_plataforma bigint,
  completa boolean,
  moneda text,
  por_mes boolean,
  descripcion_plan text,
  sub_cuenta boolean,
  detalles text,
  segundo_plan boolean,
  id_descuento_mes bigint,
  id_descuento_cantidad bigint,
  id_descuento_mes_detal bigint,
  id_descuento_mes_mayor bigint,
  id_descuento_cantidad_detal bigint,
  id_descuento_cantidad_mayor bigint,
  aplica_descuento_mes_detal boolean NOT NULL DEFAULT true,
  aplica_descuento_mes_mayor boolean NOT NULL DEFAULT true,
  aplica_descuento_cantidad_detal boolean NOT NULL DEFAULT true,
  aplica_descuento_cantidad_mayor boolean NOT NULL DEFAULT true,
  CONSTRAINT precios_pkey PRIMARY KEY (id_precio),
  CONSTRAINT precios_id_plataforma_fkey FOREIGN KEY (id_plataforma) REFERENCES public.plataformas(id_plataforma)
);
CREATE TABLE public.proveedores (
  id_proveedor bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  nombre character varying NOT NULL,
  whatsapp text,
  telegram text,
  CONSTRAINT proveedores_pkey PRIMARY KEY (id_proveedor)
);
CREATE TABLE public.reemplazos (
  id_reemplazo bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_cuenta bigint NOT NULL,
  id_perfil bigint,
  id_sub_cuenta bigint,
  CONSTRAINT reemplazos_pkey PRIMARY KEY (id_reemplazo),
  CONSTRAINT reemplazos_id_cuenta_fkey FOREIGN KEY (id_cuenta) REFERENCES public.cuentas(id_cuenta),
  CONSTRAINT reemplazos_id_perfil_fkey FOREIGN KEY (id_perfil) REFERENCES public.perfiles(id_perfil)
);
CREATE TABLE public.reporte_tipos (
  id_tipo_reporte bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  titulo text NOT NULL,
  Solucion text,
  CONSTRAINT reporte_tipos_pkey PRIMARY KEY (id_tipo_reporte)
);
CREATE TABLE public.reportes (
  id_reporte bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_usuario bigint,
  id_plataforma bigint,
  id_cuenta bigint,
  id_perfil bigint,
  descripcion text,
  imagen text,
  en_revision boolean,
  solucionado boolean,
  fecha_creacion date,
  hora_creacion time without time zone,
  solucionado_por bigint,
  descripcion_solucion text,
  id_tipo_reporte bigint,
  CONSTRAINT reportes_pkey PRIMARY KEY (id_reporte),
  CONSTRAINT reportes_id_cuenta_fkey1 FOREIGN KEY (id_cuenta) REFERENCES public.cuentas(id_cuenta),
  CONSTRAINT reportes_id_perfil_fkey FOREIGN KEY (id_perfil) REFERENCES public.perfiles(id_perfil),
  CONSTRAINT reportes_id_plataforma_fkey FOREIGN KEY (id_plataforma) REFERENCES public.plataformas(id_plataforma),
  CONSTRAINT reportes_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT reportes_id_tipo_reporte_fkey FOREIGN KEY (id_tipo_reporte) REFERENCES public.reporte_tipos(id_tipo_reporte)
);
CREATE TABLE public.tareas (
  id_tarea bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  titulo text,
  detalle text,
  CONSTRAINT tareas_pkey PRIMARY KEY (id_tarea)
);
CREATE TABLE public.tareas_asignadas (
  id_tarea_asignada bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  id_tarea bigint NOT NULL,
  cuenta bigint,
  CONSTRAINT tareas_asignadas_pkey PRIMARY KEY (id_tarea_asignada),
  CONSTRAINT tareas_asignadas_cuenta_fkey FOREIGN KEY (cuenta) REFERENCES public.cuentas(id_cuenta),
  CONSTRAINT tareas_asignadas_id_tarea_fkey FOREIGN KEY (id_tarea) REFERENCES public.tareas(id_tarea)
);
CREATE TABLE public.tarjetas_de_regalo (
  id_tarjeta_de_regalo bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  pin text,
  monto real,
  id_proveedor bigint,
  id_plataforma bigint,
  costo real,
  para_venta boolean,
  usado boolean,
  vendido_a bigint,
  fecha_compra date,
  fecha_uso date,
  id_cuenta bigint,
  CONSTRAINT tarjetas_de_regalo_pkey PRIMARY KEY (id_tarjeta_de_regalo),
  CONSTRAINT tarjetas_de_regalo_id_proveedor_fkey FOREIGN KEY (id_proveedor) REFERENCES public.proveedores(id_proveedor),
  CONSTRAINT tarjetas_de_regalo_id_plataforma_fkey FOREIGN KEY (id_plataforma) REFERENCES public.plataformas(id_plataforma),
  CONSTRAINT tarjetas_de_regalo_vendido_a_fkey FOREIGN KEY (vendido_a) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT tarjetas_de_regalo_id_cuenta_fkey FOREIGN KEY (id_cuenta) REFERENCES public.cuentas(id_cuenta)
);
CREATE TABLE public.testing (
  id_testing bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  testing boolean NOT NULL,
  CONSTRAINT testing_pkey PRIMARY KEY (id_testing)
);
CREATE TABLE public.usuarios (
  id_usuario bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  nombre text NOT NULL,
  telefono text,
  apellido text,
  ultima_conexion date,
  fecha_registro date,
  correo text,
  acceso_cliente boolean,
  permiso_admin boolean,
  permiso_superadmin boolean,
  auth_id bigint,
  id_auth uuid UNIQUE,
  claim_token text UNIQUE,
  claim_expires timestamp with time zone,
  notificacion_inventario boolean,
  saldo double precision,
  recordatorio_dias_antes smallint,
  foto_perfil text,
  fondo_perfil text,
  fecha_ultima_compra date,
  fecha_registro_admin date,
  CONSTRAINT usuarios_pkey PRIMARY KEY (id_usuario)
);
CREATE TABLE public.ventas (
  id_venta bigint GENERATED ALWAYS AS IDENTITY NOT NULL UNIQUE,
  id_usuario bigint,
  id_cuenta bigint,
  id_perfil bigint,
  fecha_pago date,
  fecha_corte date,
  monto real,
  id_tarjeta_de_regalo bigint,
  id_orden bigint,
  reportado boolean,
  vencido boolean,
  suspendido boolean,
  infinito boolean,
  corte_reemplazo boolean,
  meses_contratados smallint,
  pendiente boolean,
  pago_verificado boolean,
  pago_rechazado boolean,
  id_precio bigint,
  id_sub_cuenta bigint,
  id_admin_venta bigint,
  correo_miembro text,
  clave_miembro text,
  aviso_corte boolean,
  id_cuenta_miembro bigint,
  renovacion boolean,
  completa boolean,
  cuenta_nueva boolean,
  nombre_cliente text,
  recordatorio_enviado boolean,
  cuenta_pagada_admin boolean,
  CONSTRAINT ventas_pkey PRIMARY KEY (id_venta),
  CONSTRAINT ventas_id_cuenta_fkey FOREIGN KEY (id_cuenta) REFERENCES public.cuentas(id_cuenta),
  CONSTRAINT ventas_id_perfil_fkey FOREIGN KEY (id_perfil) REFERENCES public.perfiles(id_perfil),
  CONSTRAINT ventas_id_tarjeta_de_regalo_fkey FOREIGN KEY (id_tarjeta_de_regalo) REFERENCES public.tarjetas_de_regalo(id_tarjeta_de_regalo),
  CONSTRAINT ventas_id_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT ventas_id_orden_fkey FOREIGN KEY (id_orden) REFERENCES public.ordenes(id_orden),
  CONSTRAINT ventas_id_admin_venta_fkey FOREIGN KEY (id_admin_venta) REFERENCES public.usuarios(id_usuario),
  CONSTRAINT ventas_id_cuenta_miembro_fkey FOREIGN KEY (id_cuenta_miembro) REFERENCES public.cuentas(id_cuenta),
  CONSTRAINT ventas_id_precio_fkey FOREIGN KEY (id_precio) REFERENCES public.precios(id_precio)
);