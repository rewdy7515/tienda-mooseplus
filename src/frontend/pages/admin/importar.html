<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Importar datos</title>
    <link rel="stylesheet" href="../../styles/styles.css" />
  </head>
  <body>
    <div id="app-header" data-header-root="../../" data-header-pages="../"></div>
    <script src="../../scripts/header-loader.js"></script>

    <main class="categorias-dinamicas">
      <h2>Importar datos</h2>
      <div class="admin-actions">
        <button class="btn-primary admin-action" id="btn-importar-pines">Pines de perfiles</button>
        <button class="btn-primary admin-action" id="btn-importar-clientes">Clientes</button>
        <button class="btn-primary admin-action" id="btn-importar-cuentas">Cuentas</button>
        <button class="btn-primary admin-action" id="btn-importar-canva">Importar Canva</button>
        <button class="btn-primary admin-action" id="btn-importar-spotify">Importar Spotify</button>
        <button class="btn-primary admin-action" id="btn-importar-contactos">Importar contactos</button>
      </div>
      <p class="status">Selecciona qu√© deseas importar.</p>
    </main>

    <script type="module">
      import { requireSession, attachLogout, attachLogoHome } from "../../scripts/session.js";
      import { clearServerSession, loadCurrentUser } from "../../scripts/api.js";

      requireSession();

      const usernameEl = document.querySelector(".username");
      const adminLink = document.querySelector(".admin-link");
      const isTrue = (v) => v === true || v === 1 || v === "1" || v === "true" || v === "t";

      async function init() {
        try {
          const user = await loadCurrentUser();
          if (user && usernameEl) {
            const fullName = [user.nombre, user.apellido].filter(Boolean).join(" ").trim();
            usernameEl.textContent = fullName || user.correo || "Usuario";
          }
          const isAdmin = isTrue(user?.permiso_admin) || isTrue(user?.permiso_superadmin);
          if (adminLink) {
            adminLink.classList.toggle("hidden", !isAdmin);
            adminLink.style.display = isAdmin ? "block" : "none";
          }
          if (!isAdmin) {
            document.querySelector("main .status").textContent =
              "No tienes permisos para administrar servicios.";
          }
        } catch (err) {
          console.error("importar menu init error", err);
        }
      }

      init();
      attachLogout(clearServerSession);
      attachLogoHome();

      document.querySelector("#btn-importar-pines")?.addEventListener("click", () => {
        window.location.href = "importar_pines.html";
      });
      document.querySelector("#btn-importar-clientes")?.addEventListener("click", () => {
        window.location.href = "importar_clientes.html";
      });
      document.querySelector("#btn-importar-cuentas")?.addEventListener("click", () => {
        window.location.href = "importar_cuentas.html";
      });
      document.querySelector("#btn-importar-canva")?.addEventListener("click", () => {
        window.location.href = "import_canva.html";
      });
      document.querySelector("#btn-importar-spotify")?.addEventListener("click", () => {
        window.location.href = "importar_spotify.html";
      });
      document.querySelector("#btn-importar-contactos")?.addEventListener("click", () => {
        window.location.href = "importar_contactos.html";
      });
    </script>
  </body>
</html>
